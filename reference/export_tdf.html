<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Export data in the Textual Dataset File Format — export_tdf • tidyfr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Export data in the Textual Dataset File Format — export_tdf"><meta property="og:description" content='The export_tdf exports the provided data in the TDFF format. The function
first creates all required folders, checks the input
files and then exports the data in the TDFF format (see below for more
information on this format).
The data is organized in the following way:
Within the base directory path a folder name is created for the
data set.
Within a folder with the version of the data set (parameter version)
two folders data and docs are created. The actual data files
are stored in the data folder while the docs folder allows to
contains any documentation files (any file) related to the data set. The
docs folder contains also a file docs.txt that is supposed to
contain information for any added documentation file (this information
needs to be manually addedd).
Within the base folder (with the name of the data set) a NEWS.md file
is created which is supposed to be manually edited to add some
information or change log for the currently exported version of the
data.


Automatic convertions performed by the export function are:
Columns in data that are of data type factor are correctly and
automatically converted to the expected format (i.e. their categories are
added to the mapping data.frame and the values are replaced with the
indices).
If not specified in labels, columns "min", "max" in labels are
calculated on the provided data.
Missing values in data are automatically converted and the respective
encoding specified in labels.


The labels_from_data creates a template labels data.frame from the
provided data. The function retrieves various information like the data
type of the various columns from the provided data and adds the
corresponding values to the data.frame. Other columns, such as
"description" or "unit" need to be filled out manually.
The mapping_from_data creates a mapping data.frame for all categorical
variables in data (i.e. columns in data with data type factor).'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyfr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/tidyfr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/EuracBiomedicalResearch/tidyfr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Export data in the Textual Dataset File Format</h1>
    <small class="dont-index">Source: <a href="https://github.com/EuracBiomedicalResearch/tidyfr/blob/HEAD/R/data-export.R" class="external-link"><code>R/data-export.R</code></a></small>
    <div class="hidden name"><code>export_tdf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>export_tdf</code> exports the provided data in the TDFF format. The function
first creates all required folders, checks the input
files and then exports the data in the TDFF format (see below for more
information on this format).</p>
<p>The data is organized in the following way:</p><ul><li><p>Within the base directory <code>path</code> a folder <code>name</code> is created for the
data set.</p></li>
<li><p>Within a folder with the version of the data set (parameter <code>version</code>)
two folders <em>data</em> and <em>docs</em> are created. The actual data files
are stored in the <em>data</em> folder while the <em>docs</em> folder allows to
contains any documentation files (any file) related to the data set. The
<em>docs</em> folder contains also a file <em>docs.txt</em> that is supposed to
contain information for any added documentation file (this information
needs to be manually addedd).</p></li>
<li><p>Within the base folder (with the name of the data set) a <em>NEWS.md</em> file
is created which is supposed to be manually edited to add some
information or change log for the currently exported version of the
data.</p></li>
</ul><p>Automatic convertions performed by the export function are:</p><ul><li><p>Columns in <code>data</code> that are of data type <code>factor</code> are correctly and
automatically converted to the expected format (i.e. their categories are
added to the <code>mapping</code> <code>data.frame</code> and the values are replaced with the
indices).</p></li>
<li><p>If not specified in <code>labels</code>, columns <code>"min"</code>, <code>"max"</code> in <code>labels</code> are
calculated on the provided <code>data</code>.</p></li>
<li><p>Missing values in <code>data</code> are automatically converted and the respective
encoding specified in <code>labels</code>.</p></li>
</ul><p>The <code>labels_from_data</code> creates a <em>template</em> <em>labels</em> <code>data.frame</code> from the
provided <code>data</code>. The function retrieves various information like the data
type of the various columns from the provided <code>data</code> and adds the
corresponding values to the <code>data.frame</code>. Other columns, such as
<code>"description"</code> or <code>"unit"</code> need to be filled out manually.</p>
<p>The <code>mapping_from_data</code> creates a <em>mapping</em> <code>data.frame</code> for all categorical
variables in <code>data</code> (i.e. columns in <code>data</code> with data type <code>factor</code>).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">export_tdf</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  description <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  path <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  grp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu">labels_from_data</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu">mapping_from_data</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>  na <span class="op">=</span> <span class="op">-</span><span class="fl">89</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">labels_from_data</span><span class="op">(</span><span class="va">data</span>, na <span class="op">=</span> <span class="op">-</span><span class="fl">89</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mapping_from_data</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>name</dt>
<dd><p><strong>required</strong> <code>character(1)</code> with the name of the data module.</p></dd>


<dt>description</dt>
<dd><p><code>character(1)</code> providing a description of the data.</p></dd>


<dt>version</dt>
<dd><p><strong>required</strong> <code>character(1)</code> with the version of the data.</p></dd>


<dt>date</dt>
<dd><p><code>character(1)</code> providing the date of the data.</p></dd>


<dt>path</dt>
<dd><p><code>character(1)</code> with the base path where the folders and data
files should be created. Defaults to <code>path = "."</code>.</p></dd>


<dt>data</dt>
<dd><p><code>data.frame</code> with the data to export. Required column <code>"aid"</code> is
expected to contain the unique identifiers of the participants. All
additional columns are expected to contain the data of additional
variables.</p></dd>


<dt>groups</dt>
<dd><p><code>data.frame</code> with optional grouping of labels (variables) in
<code>data</code>. Expected columns are <code>"group"</code> and <code>"label"</code>. See the TDF
definition for details.</p></dd>


<dt>grp_labels</dt>
<dd><p><code>data.frame</code> with the names (descriptions) of the groups
defined in <code>groups</code>.</p></dd>


<dt>labels</dt>
<dd><p><code>data.frame</code> with <em>annotations</em> to the variables (labels) in
<code>data</code>. See the TDF definition for details. Columns <code>"min"</code>, <code>"max"</code>
and <code>"missing"</code> will be filled by the <code>export_tdf</code> function if not
already provided. Defaults to <code>labels = labels_from_data()</code> hence
creates a <em>labels</em> <code>data.frame</code> from the provided <code>data</code>. Any
annotations that are not part of the pre-defined hard set of
columns are stored in a separate file <em>labels_additional_info.txt</em>.</p></dd>


<dt>mapping</dt>
<dd><p><code>data.frame</code> with the definition of the levels (categories)
of the categorical variables in <code>labels</code>. Expected columns are
<code>"label"</code>, <code>"code"</code> and <code>"value"</code>. The default is
<code>mapping = mapping_from_data(data)</code> and a <em>mapping</em> <code>data.frame</code> is thus
generated by default from the provided <code>data</code>.</p></dd>


<dt>na</dt>
<dd><p>the value to represent missing values in <code>data</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>export_tdf</code>: (invisibly) returns a <code>character(1)</code> with the path to
the folder where the data was stored. <code>labels_from_data</code> returns a
<em>labels</em></p>
<p></p>
<p><code>data.frame</code> based on the data in <code>data</code>.</p>
    </div>
    <div id="short-information-on-the-tdf">
    <h2>Short information on the TDF</h2>
    


<p>See the official
<a href="https://wiki.gm.eurac.edu/index.php?title=Textual_Dataset_Format" class="external-link">Textual Dataset Format</a>
definition for a complete description of the format.</p><ul><li><p><strong>data</strong>: contains the data of the various variables. Columns are
variables, rows study participants. Column <code>"aid"</code> is mandatory and
contains the ID of the study participants.</p></li>
<li><p><strong>labels</strong>: provides information on the variables in <em>data</em>. Columns are
<code>"label"</code> (the name of the column in <em>data</em>), <code>"unit"</code> (unit of the
measured value), <code>"type"</code> (the data type), <code>"min"</code> (the minimal value),
<code>"max"</code> (the maximal value), <code>"missing"</code> (the value with which missing
values in <em>data</em> are encoded) and <code>"description"</code> (a name/description of
the variable).</p></li>
<li><p><strong>mapping</strong>: contains the encoding of categorical variables (<code>factor</code>s) in
<em>data</em>. Required columns are: <code>"label"</code> (the name of the column in <em>data</em>),
<code>"code"</code> (the value of the category in <em>data</em>) and <code>"value"</code> (the category,
i.e. the <code>level</code> of the <code>factor</code>).</p></li>
<li><p><strong>groups</strong>: allows to optionally group variables in <em>data</em>. Expected
columns are <code>"group"</code> (the name of the group) and <code>"label"</code> (the name of
the column in <em>data</em>).</p></li>
<li><p><strong>grp_labels</strong>: contains descriptions for the <em>groups</em>. Expected columns
are <code>"group"</code> (the name of the group) and <code>"description"</code> (the
name/description of the group).</p></li>
</ul></div>
    <div id="author">
    <h2>Author</h2>
    <p>Johannes Rainer</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Exporting a test data set. Creating a *data* data.frame with data on</span></span></span>
<span class="r-in"><span><span class="co">## 5 individuals.</span></span></span>
<span class="r-in"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    aid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"00101"</span>, <span class="st">"00102"</span>, <span class="st">"00103"</span>, <span class="st">"00104"</span>, <span class="st">"00105"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    x0_sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Female"</span>, <span class="cn">NA</span>, <span class="st">"Male"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    x0_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fl">54</span>, <span class="fl">33</span>, <span class="fl">36</span>, <span class="fl">66</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    x0_weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">78.5</span>, <span class="fl">57.2</span>, <span class="fl">55.2</span>, <span class="fl">67.9</span>, <span class="fl">84.2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Generate a *labels* data.frame from the data</span></span></span>
<span class="r-in"><span><span class="va">l</span> <span class="op">&lt;-</span> <span class="fu">labels_from_data</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">l</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               label unit        type  min  max missing description</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0_sex       x0_sex      categorical   NA   NA     -89            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0_age       x0_age            float 33.0 66.0     -89            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0_weight x0_weight            float 55.2 84.2     -89            </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Fill missing information to labels</span></span></span>
<span class="r-in"><span><span class="va">l</span><span class="op">$</span><span class="va">unit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"Year"</span>, <span class="st">"kg"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">l</span><span class="op">$</span><span class="va">description</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sex"</span>, <span class="st">"Age"</span>, <span class="st">"Weight"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Generate a *mapping* data.frame from data</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu">mapping_from_data</span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           label code  value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0_sex.1 x0_sex    1 Female</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x0_sex.2 x0_sex    2   Male</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a simple grouping of all variables into a "general information"</span></span></span>
<span class="r-in"><span><span class="co">## group</span></span></span>
<span class="r-in"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ginfo"</span>, <span class="st">"ginfo"</span>, <span class="st">"ginfo"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x0_sex"</span>, <span class="st">"x0_age"</span>, <span class="st">"x0_weight"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Define a description for the group</span></span></span>
<span class="r-in"><span><span class="va">gl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group <span class="op">=</span> <span class="st">"ginfo"</span>, description <span class="op">=</span> <span class="st">"General information"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Now export all data to a temporary folder</span></span></span>
<span class="r-in"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Export the data specifying the name of the module, the version and other</span></span></span>
<span class="r-in"><span><span class="co">## information</span></span></span>
<span class="r-in"><span><span class="fu">export_tdf</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"test_data"</span>, description <span class="op">=</span> <span class="st">"Simple test data."</span>,</span></span>
<span class="r-in"><span>    version <span class="op">=</span> <span class="st">"1.0.0"</span>, date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="op">)</span>, path <span class="op">=</span> <span class="va">path</span>, data <span class="op">=</span> <span class="va">d</span>,</span></span>
<span class="r-in"><span>    groups <span class="op">=</span> <span class="va">g</span>, grp_labels <span class="op">=</span> <span class="va">gl</span>, labels <span class="op">=</span> <span class="va">l</span>, mapping <span class="op">=</span> <span class="va">m</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Data set was written to: /tmp/Rtmp2iM8p8/test_data/1.0.0/data</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Johannes Rainer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

